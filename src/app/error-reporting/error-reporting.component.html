<div class="container">

<div *ngIf="!authorized" class="login-box">
  <h2>Restricted Access</h2>

  <input
    type="password"
    [(ngModel)]="passwordInput"
    placeholder="Enter password"
  />

  <button (click)="checkPassword()">Enter</button>

  <p class="error" *ngIf="authError">
    Incorrect password
  </p>
</div>

<div *ngIf="authorized">
    <h2>Mesonet Error Reporting Form</h2>

        <form #f="ngForm" (ngSubmit)="submitForm()" novalidate>


        <label>
          Username<span class="required">*</span>
        </label>

        <input type="text" [(ngModel)]="formData.username" name="username" required />

        <label>Station<span class="required">*</span></label>

        <div class="dropdown">

          <div class="dropdown-display" (click)="dropdownOpen = !dropdownOpen">
            {{ formData.stationNumber || 'Select a station...' }}
          </div>

          <div class="dropdown-panel" *ngIf="dropdownOpen">

            <input
              type="text"
              placeholder="Search..."
              [(ngModel)]="stationSearch"
              (input)="filterStations()"
              name="stationSearch"
              class="dropdown-search"
            required
            />

            <div
              class="dropdown-option"
              *ngFor="let st of filteredStations"
              (click)="selectStation(st)"
            >
              {{ st.station_id }} {{ st.name }}
            </div>

          </div>
        </div>

        <label>
          Variable ID(s)<span class="required">*</span>
        </label>

        <div class="dropdown">
          <div
            class="dropdown-display"
            (click)="varDropdownOpen = !varDropdownOpen"
          >
            {{ getVariableSummary() }}
          </div>


          <div class="dropdown-panel" *ngIf="varDropdownOpen">

            <div class="select-all-row">
              <label>
                <input
                  type="checkbox"
                  #selectAll
                  [checked]="allVariablesSelected()"
                  (change)="selectAllVariables(selectAll.checked)"
                />
                Select all variables
              </label>
            </div>

            <hr class="divider" />

            <!-- Search -->
            <input
              type="text"
              placeholder="Search variable..."
              [(ngModel)]="variableSearch"
              (input)="filterVariables()"
              name="variableSearch"
              class="dropdown-search"
            />

            <!-- Variable list -->
            <label
              *ngFor="let v of filteredVariables"
              class="variable-option"
            >
              <input
                type="checkbox"
                [checked]="formData.variableId.includes(v)"
                (change)="toggleVariable(v)"
              />
              {{ v }}
            </label>

          </div>
        </div>


        <label>SCREENING Start Date</label>
        <input
          type="date"
          [(ngModel)]="formData.screenStartDate"
          name="screenStartDate"
          required
        />

        <label>SCREENING End Date</label>
        <input
          type="date"
          [(ngModel)]="formData.screenEndDate"
          name="screenEndDate"
          [min]="formData.screenStartDate"
          required
        />


        <label>FLAG Start Date</label>
        <input type="datetime-local" [(ngModel)]="formData.startDate" name="startDate" required/>

        <label>FLAG End Date (Leave blank if ongoing)</label>
        <input type="datetime-local" [(ngModel)]="formData.endDate" name="ecndDate" />

        <label>Flag<span class="required">*</span></label>
        <select [(ngModel)]="formData.flag" name="flag" required>
          <option *ngFor="let option of flagOptions" [value]="option">{{ option }}</option>
        </select>
        <div *ngIf="severityRequired()">
          <label>Severity<span class="required">*</span></label>
          <select
            [(ngModel)]="formData.severity"
            name="severity"
            required
          >
            <option value="" disabled>Select severity...</option>
            <option *ngFor="let s of severityOptions" [value]="s">{{ s }}</option>
          </select>
        </div>

        <label>Notes</label>
        <textarea [(ngModel)]="formData.notes" name="notes"></textarea>

        <button type="submit">Submit</button>

      </form>

</div>

</div>
